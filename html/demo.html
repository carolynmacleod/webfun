<!DOCTYPE html>

<html>
	<head>
		<meta charset="utf-8"/>
		<!-- <link rel="stylesheet" type="text/css" href="cmacleod.css"> -->
		<title>Basic Web Programming Demo</title>
	<script type="application/javascript">
		// Global variables for my basic development work.

		var square = {size:"5", pos:"1"};
		var size = 10;
		var pos = 5;


// The Game of Life
// Initialization: Random pattern of living and dead cells. Eventually pull the percentage chance of life from a box.

// Game of Life Variables
// Grid: Canvas size, each "cell" is say 10 pixels x 10 pixels, compute size of grid based on this
// Grid array: height/cell x width/cell array of cells
// Cell object: Alive/Dead status
//

		var field = {height:'300', width:'300', cell: '10'};
		var game = {
			lifeChance: '0.25', 
			gridHeight: (field.height/field.cell), 
			gridWidth: (field.width/field.cell)
		};
		const lifeStatus = {
			ALIVE: "alive",
			DEAD: "dead"
		};
		console.log('field', field);
		console.log('game', game);
		var grid = createGrid(game.gridHeight, game.gridWidth);
		console.log('grid', grid);
		

		function initializeGameOfLife(aliveProbability) {
			// initialize grid 2d array to alive/dead statuses
			for (var i=0; i<grid.length; i++) {
				for (var j=0; j<grid[i].length; j++) {
					if (Math.random() < game.lifeChance) {
						grid[i][j] = lifeStatus.ALIVE;
					} else {
						grid [i][j] = lifeStatus.DEAD;
					}}}}

		function createGrid(height, width) {
			var arr = [];
			for (var i = 0; i < height; i++) {
				arr[i] = new Array(width);
			}
			return arr;
		}


		
		function drawGameOfLife() {
			// Conway's game of life demo

			//For a space that is 'populated':
			//Each cell with one or no neighbors dies, as if by solitude.
			//Each cell with four or more neighbors dies, as if by overpopulation.
			//Each cell with two or three neighbors survives.
			//For a space that is 'empty' or 'unpopulated'
			//Each cell with three neighbors becomes populated.		
		
		
			var canvas = document.getElementById('test');
			if (canvas.getContext) {
				var ctx = canvas.getContext('2d');
				for (var i=0; i<grid.length; i++) {
					for (var j=0; j<grid[i].length; j++) {
						if (grid[i][j] == lifeStatus.ALIVE) {
							ctx.fillStyle = 'rgb(200, 0, 0)';
						}
						else {
							ctx.fillStyle = 'rgb(0, 200, 0)';
						}
						ctx.fillRect((i*field.cell), (j*field.cell), (field.cell-1), (field.cell-1));
				}}
		
			}}
		function updateGameOfLife() {
			var updatedStatusGrid = createGrid(grid.length, grid[0].length);
			// Update to copy of grid
			for (var i=0; (i<grid.length); i++) {
				for (var j=0; (j<grid[i].length); j++) {
					var neighbours = 0;
					// Count "ALIVE" neighbours
					if (i > 0) {
						if (j > 0) {
							if (grid[i-1][j-1] == lifeStatus.ALIVE) {
								neighbours ++;
							}
						}
						if (grid[i-1][j] == lifeStatus.ALIVE) {
							neighbours++;
						}
						if (j < (grid[i].length - 1)) {
							if (grid[i-1][j+1] == lifeStatus.ALIVE) {
								neighbours ++;
							}
						}
					}
					if (i < (grid.length -1)) {
						if (j > 0) {
							if (grid[i + 1][j-1] == lifeStatus.ALIVE) {
								neighbours ++;
							}
						}
						if (grid[i+1][j] == lifeStatus.ALIVE) {
							neighbours++;
						}
						if (j < (grid[i].length - 1)) {
							if (grid[i+1][j+1] == lifeStatus.ALIVE) {
								neighbours ++;
							}
						}
					}
					if (j > 0) {
						if (grid[i][j-1] == lifeStatus.ALIVE) {
							neighbours ++;
						}
					}
					if (j < (grid[i].length - 1)) {
						if (grid[i][j+1] == lifeStatus.ALIVE) {
							neighbours ++;
						}
					}
					if (grid[i][j] == lifeStatus.ALIVE) {
						if ((neighbours < 2) || (neighbours > 3)) {
							updatedStatusGrid[i][j] = lifeStatus.DEAD;
						}
						else {
							updatedStatusGrid[i][j] = lifeStatus.ALIVE;
						}
					}
					else {
						if (neighbours > 2) {
							updatedStatusGrid[i][j] = lifeStatus.ALIVE;
						}
						else {
							updatedStatusGrid[i][j] = lifeStatus.DEAD;
						}
					}

				}
			}
			// copy updated status back
			grid = updatedStatusGrid;

		}
			
		function myload() {
			initializeGameOfLife(game.lifeChance);
			drawGameOfLife();
		}

		function keymanage() {
			console.log('keyup function', '' );
			updateGameOfLife();
			drawGameOfLife();
		}

		window.addEventListener("keypress", function (evt) {
			console.log('keyup function', '' );
			var SPACEBAR = 32;
			if (evt.which === SPACEBAR) {
        			updateGameOfLife();
				drawGameOfLife();
		        	evt.preventDefault();
		    }
		});
	</script>
	</head>
	<body onload=myload() >
		
		<p>This is a basic game dev attempt</p>

		<p>
		<h4>Conway's game of life - basic web programming demo</h4> 
		<p>
		
		<ul>
			<li>For a space that is 'populated':
		<ul>
			<li>Each cell with one or no neighbors dies, as if by solitude.</li>
			<li>Each cell with four or more neighbors dies, as if by overpopulation.</li>
			<li>Each cell with two or three neighbors survives.</li></li>
		</ul>
		<li>For a space that is 'empty' or 'unpopulated':
	<ul>
				<li>Each cell with three neighbors becomes populated.</li>
			</ul></li></ul>


		<p>
		Reload the page to reinitialze the grid with a random starting configuration. Press the space bar to update the
		display.
		<p><p>

		<canvas id="test" width="300" height="300" align="left">
		This is alternate content for my canvas - If this is visible, you have disabled scripting. 
		</canvas>


		<!--
		<p>This is a very basic canvas with a static drawing</p>

		<canvas id="mover" width="300" height="300">
			This is alternate content for my second canvas
		</canvas>
		<canvas id="game" width="300" height="300">
			This is alternate content for my third canvas
		</canvas>
		/-->

		<p> This is the end</p>
	</body>
</html>
